"""Module for pipelines."""
from p_kit.core import PCircuit
from p_kit.solver.csd_solver import CaSuDaSolver
from p_kit.visualization import histplot, vin_vout,plot3d
import numpy as np
import matplotlib.pyplot as plt
import os


c = PCircuit(30)


c.J = np.array([
[0,0,-3,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-3,2,0,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[3,2,1,0,-2,-2,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[2,0,2,-2,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,-2,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,3,-3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,2,0,2,3,0,1,-2,-2,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,2,0,2,-3,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,2,-2,2,0,0,0,0,0,0,0,0,0,0,0,3,-3,2,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,-2,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,3,-3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,2,0,0,2,3,0,1,-2,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0],
[0,0,0,0,0,0,0,2,0,0,2,-3,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,-2,2,0,0,0,0,0,0,0,0,0,0,3,-3,2,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,-3,2,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3,0,1,-2,-2,2,2,0,0,0,0,0,0,0,0],
[0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,-3,1,0,2,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,-2,2,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,0,0,0,2,2,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,2,0,0,2,0,1,-2,-2,2,2,0,0,0,0],
[0,0,0,0,0,0,0,0,0,-3,0,0,0,0,0,0,2,0,0,2,1,0,2,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,-2,2,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,0,0,0,2,2,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,2,0,0,2,0,1,-2,3,-3,2],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,-3,0,0,0,0,0,2,0,0,2,1,0,2,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,-2,2,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,1,-2],
[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,-3,0,0,1,0,2],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,-2,2,0]
])





c.h = np.array([
-3,
2,
-2,
-2,
2,
0,
0,
0,
0,
0,
-3,
-3,
2,
0,
0,
-3,
-2,
-2,
10,
-3,
0,
0,
10,
0,
0,
0,
10,
-10,
-2,
-10
])



solver = CaSuDaSolver(Nt=75000, dt=0.1667, i0=0.5)

input, output = solver.solve(c)


#histplot(output)



# Get the current working directory
current_dir = os.getcwd()
print("Current Directory:", current_dir)

# Output array to a file in the current directory
file_path = os.path.join(current_dir, 'OUT_SSP_4.csv')

with open(file_path, 'w') as f:
    for element in output:
        f.write(str(element) + '\n')

print(f"Array data saved to {file_path}")




# Read data from the file
current_dir = os.getcwd()
file_path = os.path.join(current_dir, 'OUT_SSP_4.csv')

with open(file_path, 'r') as f:
    lines = f.readlines()

# Combine every set of 5 lines
combined_lines = []
for i in range(0, len(lines), 2):
    combined_line = ' '.join(line.strip() for line in lines[i:i+2])
    combined_lines.append(combined_line)

# Write combined lines to a new file
combined_file_path = os.path.join(current_dir, 'comb_OUT_SSP_4.csv')
with open(combined_file_path, 'w') as f:
    for line in combined_lines:
        f.write(line + '\n')

print(f"Combined data saved to {combined_file_path}")

